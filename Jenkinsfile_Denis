pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                bat "type *.md > index.html"
            }
        }

        stage('Delivery') {
            steps {
                archiveArtifacts artifacts: 'index.html', followSymlinks: false
            }
        }

        stage('Build Image') {
            steps {
                bat "docker build -t some-content-nginx:latest ."
            }
        }

        stage('Login') {
            steps {
                bat "echo eyJwYXlsb2FkIjoiVUpjQU1VV3dNRjRYd3ZZczh2N2JBb0xBeTl5MERTVUdJSGhZTUwrR2M1VUJmdFdWWm5XK1U5QW5KUWM4WitXWmd5ZlhMVm9iWXE1RDFxMXdaLzB2MThPaElpNzZnby9CUjB4eDVqc2ZjcFVzV2dYQ2MzalIyRlVIYzNvNko4dDJVazMxQy9oZ1RTZWdXQzcxYUNHdDlHd3d5YnIxaXhEc29pNGkzdG9wUzJqcDdobWN3ajVJbFBjUm9FUkNTZkJCZjZMSWJFcGRiTGFIb00wWUcvSVdUOCtqK0JNMmhxU2VwNWp2U3hrbUNGYm9McjNaY3VCWHlIeTBKSWw4azNVby85WTRuck51Z3lEUEJrcEsxYTIzMDBUck4vUWk2QU5HZEpUMG5uRjF2T3MvUFJUWllyUW9NcGpYSFZyL2p1U2dOZkErN3lXNlJiSXI1WUthYkQyUittZksrNDRlcGhzVWlsZHV3VjlvMlhLSUdUbjlZVVMzVWI1U1FKbVVDbWVqTWUrMHc0T3picVFEVXpIM2I3Q091R0Z2QXJvaHorZkdYb2t0VElWWWhDMytOL1B5NjRCTUptNHlMblEwcm9XZ0xuR3Q2T3IrcWZGUFRNVGREM2xYT2E5dVNNU1RiTmg1VEp0dWtmeHpRM08wZUFBeVhKWXlhck9jVGF1S2VzQ3ZCNGZQbWYwODBlTjV5UW1uL1FGL2dOTE1IcHhGT0JEMlNqUXY2UTd5Y2ZZSm1RZnRObTBWNzJ6N2NzVDNVVWNPM2hoWDdCd1NhT2dQanVTS3pTbm1UbDJCeHhqRXlYU1dhSGgrR0xSaW1rODBkUzZxN0hyUitzWXVsMU9vUWxNbEdUekZ4ODh1bHRHdS80eWtlM0ZwU3o0SFYxQ2RBcEgweW5wSWMraWpUUkY1VXlneG1mRTFUcWVlRDQ3VjMwS0dDdFYvMnlzYUNtWE41eGszckFmditpQkZ2dEdxaHpiRHRnaHp2dVdxaU5HQmdnSnNVblFaRlJFaTNiOVdoTWdGRGZDVHhDVXp2NzJRenBrVkpjVVFCZHVLRUZiZnhBamxiSHBkVldWajFqRDRIRmx0RGZEYkhKa1M1bnF0V3dObzdQZHQ3dnI0d0I3anJtVUJPV0tDbXlwTTFxQ1o0cVVnb2ZzcnErTGRvWnpCVEdyRHBobHNLZW0zUE5uZGcxY08wKzkzSXZSV2xhWC9ZMTBRUnlITm1uUHVSdnk1dXV4Qmx3Z05LWlBqeFNMYjgvTjBVS2lZdmhjK0xGZ1M3SWltdHhaRDZneWEycE1QdmVnRlZ1U0E4OVF6bEpscGl3cmlkZ1hNcHQxYkRoT0JSQmdKckVxOHR2cU5wV1A1T010ZDRzT1hSUCt0Y253UVY0dSt2aUhTZUJYT1Uzb1pubmZheVhvaXc3L3J6VGpCeXY1dWRyRVZFQWVTci9LeXp5RndrcU9KK0FuUmNPZVVGM2RjTXViTHl6bEU3VEp2RGFVaWx1NlpqOUJHSWM0eXpMc1NmVEcvUEtRazgzY0V1enh0ZG5oeHNsZ0h4RmhOYXJPRnRFL1ZHRkhzZzExRlA4TTlROXhZdGFoaVl6Q251WS9lTVkwcENKUDNNQ011Z3V0T0RHUFVHU21CZ0c0d2tGM0sxcEc2K2I4N2ozOXZuZ1R5R0FabFdBSnNpdlVvMEl5eGY1Z09JeVF0YktJUm8yWTFPY2xsVGtCSTdGWnJLNTNsS1FrczQyaktxVWwwVVI5R3VlZEQxYjAyR1FwVGFoUEgzMHRZblFlMEFZYkVvd0V4WFNQa1c0ZndpV2Exa1dVb3k5aFI1YThsTnVucDIycnJLU0dkOXJ6NEpiZUY1VUpBQmlFMGJKbWw0NU9rMnZKanAwb3lXN0hCZ3p0VlE0THJDYmNaTnVwT2RnZTRpdlBValhoRE5mMmNML3oyb3hHWC9RNUNoNkFkWFpqV3htclYxYjZJWU9sb1FlWkduc2lyV2YveFNsTWljVlJkZmxIcE5LTHJpOTA9IiwiZGF0YWtleSI6IkFRRUJBSGh3bTBZYUlTSmVSdEptNW4xRzZ1cWVla1h1b1hYUGU1VUZjZTlScTgvMTR3QUFBSDR3ZkFZSktvWklodmNOQVFjR29HOHdiUUlCQURCb0Jna3Foa2lHOXcwQkJ3RXdIZ1lKWUlaSUFXVURCQUV1TUJFRURHNjc0WFRXYS9YQ3hOUWc1QUlCRUlBN2x1ZlJUQk9JNDlpdFVibWY5SzVEZm1lSENQcFFTZnducFhvbmF2L0ZiZTNNYXVCTG5kYkZXRm9VQ3V1WlQ2SWpyaVlpcjJEb1BDR29kYmc9IiwidmVyc2lvbiI6IjIiLCJ0eXBlIjoiREFUQV9LRVkiLCJleHBpcmF0aW9uIjoxNzEzNTc3MTI4fQ== | docker login --username AWS --password-stdin 716415768780.dkr.ecr.us-east-1.amazonaws.com"
            }
        }

        stage('Push ECR') {
            steps {
                bat "docker tag some-content-nginx:latest 716415768780.dkr.ecr.us-east-1.amazonaws.com/some-content-nginx:latest"
                bat "docker push 716415768780.dkr.ecr.us-east-1.amazonaws.com/some-content-nginx:latest"
            }
        }
    }
}
