pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                bat "type *.md > index.html"
            }
        }

        stage('Delivery') {
            steps {
                archiveArtifacts artifacts: 'index.html', followSymlinks: false
            }
        }

        stage('Build Image') {
            steps {
                bat "docker build -t some-content-nginx ."
            }
        }

        stage('Login') {
            steps {
                bat "echo eyJwYXlsb2FkIjoiMFhONTFRbjZwUGs5N0Yyelo0YTFYSnZaZm1yM0Z1QWpxOHRyK2NRdlBnV3NLM21FRTNUMjhvZWVSaW4vaHlQc0RDeHkya3Y2NXRoRmxsN2RQRDczVW1yODFTa0dqWDBUbTBpb2c0S1AzMWZRdlpxNnVWVXRsNDhDd1NiOFhKa2VnNkJLRU03VmhlZHJNV1hEQ2VPUEI2ejVTclBGNm5WelVKNW01SkZWMGEzdnNYSXFWQnNwSXhtNUc3bFVmNzlIZUpSSDNkMldISXpXMnNhVmVPUnNMZmEwQkxpTUh0QVBmQVFnY3pwT0hVSFhvaVN3WXJZQzk5UTRGNG9RMmFHb01MSFFJUHd0NUNxVmpscC94Sll6bXFQUDFLSUlRVU9aS0ZQRmJmNWFTdWpCZG1IUGQ5NloyZmgrME9mcUNUWG4xN3cwd0pJdzNWdWxvWHZLWDduL25aQitqcGxmSlAxNVZmd2hzcVY2aVgxeEFpUjhiMVZtdnVmempnbnhaOGZuaVNWbzd2UGQvYWhqWUVpbU9MTVVPTkJZVVdFMFduTDQ2dkVFZ0pkTWV6eE5GU3N5WW1KRmdnZVFrRmVMWkY1TmprbmcvSWxuNmJ5NGJYQWx1cjJ2ZytEeCs4RVlHNlZBTFkrR0NSVjhsS2lIZ0tOU2RNdm9FMWx3MVNYVFZKcGI2N0xJRFRFS2pneXE4WUVBSmxvbGtQMFZpUDZ1Vzg2Slp1SVBzOE1NNEFBYXRkeGJ3K2VxUUFYMmlGem5tMDN2VUtFYXFFRFJLRTd0V2VRdEhhZHdJNGtNd2NsSlg3TDJjY2JVeWtTNkxWTEx6bkVJRGZSLzRidzRibUx3MTUzWDNURytVd2xCTVhaU0JHNDFRVnBHc3VyVjM2clV0N2EvRkZhbjFlZ1MyOVExTjJyaDcwY21XYzRJbndyVkdSeHZ5dTZmaEVLelQwaTZlSk83WTNUeHYyWnpVQ2FCRndkbnRvN2cwN2sxcFJzaHJUMFFKMVhNcmpXTHMzdVE3cXNVOTMzWGM1WFdDWjJwNHlDZTFtdXZhSE8yaDQvTi95czZqWlJkREhCWnJlQWVLM0hLOGxNMFluRkZBYi9xeTJQVWRaZ09NdWRMZHhEbUJLYjNHQTc0bG9LbGh1cEZHdm9uTWFDbS9VTFZOWWdQTkUySkx5V1BpcUt0S3orYlhkWXc1djBpZlFSRDhMd29PZS9wVzdHM2YzMHVNSVB3OE1iTzNlMFFscG5mY0JRcFJqUjVlLzQ1R1dkcVZZdXhkUGVYcFB6dW9zcmkyYkljNld3djJKSi9JQ1hOT0RiU3lLWU1zRXRERkhYWXoyR2F3WlZzek0wb1N2aEN2NFBHVWd0alQvL1RqQlBNRXRUSnFuajkrV0R2dWVsMzhEdFdvWk9mMm5GYVBJeDhPOU8ydjJhaStCbkFCZWpjK1ZycUhzS0JFciswZSs3Mk9NTHpwMHJEdy9YaSswUE1mQlY5UWNHV0gzZXpPNk9qQ0sxejk4cUNrbUlURHVHQzFBSHFVeWJJQ0VxSmZsaW1nbERYRzlvRlJycnZ5L25hOWNQTEIrUFI0TXl3TzNBRkdDYnNXMjRtWEVpT1VkUlRiNEhlZ3IxcjNaRUZZbHRoYmN1OE13RzRsaHVHYnRPaSsxam5iUkxpL2FNeUhGOXpXSWVHVHVkZ1E5Tzh2SEdDSHRpRHNORGdLRXFnYnU5THRRT3VPajhIb0ZTa2sxQ25wZzZWTGovWVhuZ0RZQkI5aFBEeXhwWXRsV1NZazJwMlFFQUdXZkNPSG1vOGxJZzJCRFE4V09ZNnFBPT0iLCJkYXRha2V5IjoiQVFFQkFIaHdtMFlhSVNKZVJ0Sm01bjFHNnVxZWVrWHVvWFhQZTVVRmNlOVJxOC8xNHdBQUFINHdmQVlKS29aSWh2Y05BUWNHb0c4d2JRSUJBREJvQmdrcWhraUc5dzBCQndFd0hnWUpZSVpJQVdVREJBRXVNQkVFREIrMStNRUZmVWdsdzAyTWRBSUJFSUE3SUE1SUN1NUpBaXhIM0E5NGE2ZVQ5dG1iMEx5aXFSUzY1bHBWVXllUkd3aWM5c2NsemFhRFhMZW5DemloajNZeEkyVDZ6YmZKSlhkZittRT0iLCJ2ZXJzaW9uIjoiMiIsInR5cGUiOiJEQVRBX0tFWSIsImV4cGlyYXRpb24iOjE3MTM1NzU4MjR9 | docker login --username AWS --password-stdin 716415768780.dkr.ecr.us-east-1.amazonaws.com"
            }
        }

        stage('Push ECR') {
            steps {
                bat "docker build -t some-content-nginx:latest ."
                bat "docker tag some-content-nginx:latest 716415768780.dkr.ecr.us-east-1.amazonaws.com/some-content-nginx:latest"
                bat "docker push 716415768780.dkr.ecr.us-east-1.amazonaws.com/some-content-nginx:latest"
            }
        }
    }
}
