pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                bat "type *.md > index.html"
            }
        }

        stage('Delivery') {
            steps {
                archiveArtifacts artifacts: 'index.html', followSymlinks: false
            }
        }

        stage('Build Image') {
            steps {
                bat "docker build -t some-content-nginx:latest ."
            }
        }

        stage('Login') {
            steps {
                bat "echo eyJwYXlsb2FkIjoiQ2hjSVZteTNyellDOE4xVGNMN2dUUnY2emgwamRRejdtMmhHNlE1ZHc2SmpCYzVzZ1Z1WEJxcUxacnczUkh5bUVUYS9EMDFxdUtaS0VteHhuWTg4RmQ5VXZvbVZBalJNdVU5MGRwR3h2SDdWNktvS2xaaDlhUGV6TGI2aWFxZXdwOVltQWFURFNqQkluak5KODZJMGc2SVBIZzlFZTRwanc4K0VLRDNka1g2eHJXdGhnRlpUampuTGFwNXp0OThENXZMUzRRYThEcllWUE1reExJVmozMFhCZWJFR2lab1J6bzhBSFR2Y1RON0o5YW9NV2tGaDZkTCtDY0RpdS8xWnk2YXFYdC84d0ZaNVl2K1JiaHJwRmJXZkw2VThzQkZhRkFFOUhnbGxaSFh1Z3J0WXJVQVA2WDY4c1FDTzZ0VWUzWEkwclZCQnlLNGhnZ1MzM0lXdGZKeXp3YUNhSDFkTzdZZXRyOXorNFAvVlY4WDhBaUNLNmZrM09BZzZhYVdvdHUvUVd3UTJTRXRhMVdxcmdmcysvNDh5YnhBejRKZDhDUW1GRTFGazM2WGl0UUJ2YmVFcWI1Wk1Kb3hYeEJHenVkM1d6YkJBQ1RodHBRLysyQmZ5RHc4TjNWK3RmR2xMTWdSK0Zwa0JadUhKUnNaakxLQi9UcE9nUGR3MjROejlrS1lXZnVQaXRSNWpBYVk4T1MrZzJQWDR2Y0Zla0lobDQzdGJYbk45TmJneEV1ZitoUGZYYS8vcUNVTGhGL0QwR0dUK3hxNXZYa2NtT1BRU1UrSlUzdWhGSTRIbG9KYmpKd1lUSFlYVzRlamdqSzBXMmxsUGtCRDlYdHVPYm1iZkFUMEEzaDgyM1ZsQ3lhdUY4VmZFTFpDSS9nczk1UWRONVRoN2tIM29vNmF5dFRiU2FZNlpGQitDSE1wUlRzcnlockwyM0FWYU01dElSKzdiVEtTZEZ2Uzk3dktNdm1xMWpJQUlhL25UTE1acTEwM1hETzZrUW1LaEtDZEJoaWpYU0JFYzdXVDJpNUloT2NkcUhIaGV2cjRMK1BaUzZ4ZmhUV1diRjB2UngzVGdiY2w5dHJRNXJ4OEZFSTdHbGZZWkQ4SHladEJlRFJnRlNJVTRyNURsZWVkWm85WTlrcUQ4UkM3TEt2Ti8yTTJBeS9kSkFJZEYwRFQrZGVYajNpejYvcW13OU9hUzZKcHJJTTFOOWYzUXROdUtmbEVUN0duV3gzcEVUSDVOczZuYkRFSFMzbW9Hb3RRdUNmVjRrU29LQldZci9DL1dhS1lIdTJKNlY3T3lzNlg5NGp1NjNMMDlnVFp2MHZoQkNibGUzRUxUZ3BHZDJkb05ONVUvS0NYZE9xU1dzY0ZTWm93SGVUc1FEaWY5UG1lNUozd2NQVXJGSmlRVHJBMFB5SER1cmJiZmsyN2N1KzQ2cWRaYVBZaU4zd0xuZjBBaGtidHZKV0FuN0tyb3pxVTE0dEd5QzVTaUtYVEZYOWlPRXNvMU9qdTFIRzJ5UURZTkhna3FvalFKVVkxUGlHbWJ4RGR5ZW8zZkNPY0lnbDBUclNLMVhrYktXOGltbTByQ0FId1ZvbnBuWm5laXhlL2ZQUUlzNnk5UUdnYnpONVBlMmdKWDNFcDBQbUZwR3IwcFQ3UzA5aExsNjFZeFhGTFVQRy9Ca3FBQTlMQ08rbGFvRXU3VHQ4enpaR0lmVW9lUmR2UDZwd1hPVk85YllLYXBRd3BNb0E0b3E3RSszVjJzZzNEYjlPL3g2YURkck1GNzhSODJGM3RKVUhETGlTU3BvVmxIaEQ5V2N5NnNGNnIvblBjc3dKbkxRcDhsb2ZEQzNmQUloNDhRVHozUStJZEpyMUtldll1VkkwcWtNV2lBbUl5YmJMYWVHRVpjaXZMTGp5dzJJYTR2Q29taHhrYzcrYVJzSmZycXdhVzRwSE00WjQ5RDFFVEoyekxTMHBuanlDS3hCNWcvb0JwMmdka1h6aU9YOHNhWFYvN2V0UzQ9IiwiZGF0YWtleSI6IkFRRUJBSGh3bTBZYUlTSmVSdEptNW4xRzZ1cWVla1h1b1hYUGU1VUZjZTlScTgvMTR3QUFBSDR3ZkFZSktvWklodmNOQVFjR29HOHdiUUlCQURCb0Jna3Foa2lHOXcwQkJ3RXdIZ1lKWUlaSUFXVURCQUV1TUJFRURKWExsT2lNVFNxU0ZKdldrQUlCRUlBN1drSisvaWRFMFlJem9EOXZ5aUhFdXpxTU92YWpLNjhncDllSG16c0V1clFjM1pNZVBGSnhBOXR3UnREL2JMamJnMW5OR0hXd05WaVQ2YU09IiwidmVyc2lvbiI6IjIiLCJ0eXBlIjoiREFUQV9LRVkiLCJleHBpcmF0aW9uIjoxNzEzNTc4MTg5fQ== | docker login --username AWS --password-stdin 716415768780.dkr.ecr.us-east-1.amazonaws.com"
            }
        }

        stage('Push ECR') {
            steps {
                bat "docker tag some-content-nginx:latest 716415768780.dkr.ecr.us-east-1.amazonaws.com/some-content-nginx:latest"
                bat "docker push 716415768780.dkr.ecr.us-east-1.amazonaws.com/some-content-nginx:latest"
            }
        }
    }
}
